/*! UIkit 2.16.2 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */
!function(t){var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-nestable",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";var s,i="ontouchstart"in window,n=t("html"),a=[],l=e.$win,o=function(){var t=document.createElement("div"),e=document.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var s=window.getComputedStyle&&"auto"===window.getComputedStyle(t,"").pointerEvents;return e.removeChild(t),!!s}(),r=i?"touchstart":"mousedown",d=i?"touchmove":"mousemove",h=i?"touchend":"mouseup",p=i?"touchcancel":"mouseup";return e.component("nestable",{defaults:{prefix:"@",listNodeName:"ul",itemNodeName:"li",listBaseClass:"{prefix}-nestable",listClass:"{prefix}-nestable-list",listitemClass:"{prefix}-nestable-list-item",itemClass:"{prefix}-nestable-item",dragClass:"{prefix}-nestable-list-dragged",movingClass:"{prefix}-nestable-moving",handleClass:"{prefix}-nestable-handle",collapsedClass:"{prefix}-collapsed",placeClass:"{prefix}-nestable-placeholder",noDragClass:"{prefix}-nestable-nodrag",emptyClass:"{prefix}-nestable-empty",group:0,maxDepth:10,threshold:20},boot:function(){e.$html.on("mousemove touchmove",function(){if(s){var t=s.offset().top;t<e.$win.scrollTop()?e.$win.scrollTop(e.$win.scrollTop()-Math.ceil(s.height()/2)):t+s.height()>window.innerHeight+e.$win.scrollTop()&&e.$win.scrollTop(e.$win.scrollTop()+Math.ceil(s.height()/2))}}),e.ready(function(t){e.$("[data-@-nestable]",t).each(function(){var t=e.$(this);if(!t.data("nestable")){e.nestable(t,e.Utils.options(t.attr("data-@-nestable")))}})})},init:function(){var n=this;n.options.prefix=e.prefix(n.options.prefix),Object.keys(this.options).forEach(function(t){-1!=String(n.options[t]).indexOf("{prefix}")&&(n.options[t]=n.options[t].replace("{prefix}",n.options.prefix))}),this.tplempty='<div class="'+this.options.emptyClass+'"/>',this.find(">"+this.options.itemNodeName).addClass(this.options.listitemClass).end().find("ul:not(.ignore-list)").addClass(this.options.listClass).find(">li").addClass(this.options.listitemClass),this.element.children(this.options.itemNodeName).length||this.element.append(this.tplempty),this.element.data("nestable-id","ID"+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random())),this.reset(),this.element.data("nestable-group",this.options.group),this.placeEl=t('<div class="'+this.options.placeClass+'"/>'),this.find(this.options.itemNodeName).each(function(){n.setParent(t(this))}),this.on("click","[data-nestable-action]",function(e){if(!n.dragEl&&(i||0===e.button)){e.preventDefault();var s=t(e.currentTarget),a=s.data("nestableAction"),l=s.closest(n.options.itemNodeName);"collapse"===a&&n.collapseItem(l),"expand"===a&&n.expandItem(l),"toggle"===a&&n.toggleItem(l)}});var a=function(e){var s=t(e.target);if(!s.hasClass(n.options.handleClass)){if(s.closest("."+n.options.noDragClass).length)return;s=s.closest("."+n.options.handleClass)}!s.length||n.dragEl||!i&&0!==e.button||i&&1!==e.touches.length||(e.preventDefault(),n.dragStart(i?e.touches[0]:e),n.trigger("start.uk.nestable",[n]))},o=function(t){n.dragEl&&(t.preventDefault(),n.dragMove(i?t.touches[0]:t),n.trigger("move.uk.nestable",[n]))},c=function(t){n.dragEl&&(t.preventDefault(),n.dragStop(i?t.touches[0]:t),n.trigger("stop.uk.nestable",[n])),s=!1};i?(this.element[0].addEventListener(r,a,!1),window.addEventListener(d,o,!1),window.addEventListener(h,c,!1),window.addEventListener(p,c,!1)):(this.on(r,a),l.on(d,o),l.on(h,c))},serialize:function(){var e,s=0,i=this,n=function(e,s){var a=[],l=e.children(i.options.itemNodeName);return l.each(function(){var e=t(this),l=t.extend({},e.data()),o=e.children(i.options.listNodeName);o.length&&(l.children=n(o,s+1)),a.push(l)}),a};return e=n(i.element,s)},list:function(e){var s=[],i=this,n=0,e=t.extend({},i.options,e),a=function(i,n,l){var o=i.children(e.itemNodeName);o.each(function(i){var o=t(this),r=t.extend({parent_id:l?l:null,depth:n,order:i},o.data()),d=o.children(e.listNodeName);s.push(r),d.length&&a(d,n+1,o.data(e.idProperty||"id"))})};return a(i.element,n),s},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null;for(var t=0;t<a.length;t++)a[t].children().length||a[t].append(this.tplempty);a=[]},toggleItem:function(t){this[t.hasClass(this.options.collapsedClass)?"expandItem":"collapseItem"](t)},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){var e=t.children(this.options.listNodeName);e.length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var e=this;this.find(e.options.itemNodeName).each(function(){e.expandItem(t(this))})},collapseAll:function(){var e=this;this.find(e.options.itemNodeName).each(function(){e.collapseItem(t(this))})},setParent:function(t){t.children(this.options.listNodeName).length&&t.addClass("uk-parent")},unsetParent:function(t){t.removeClass("uk-parent "+this.options.collapsedClass),t.children(this.options.listNodeName).remove()},dragStart:function(i){var a=this.mouse,l=t(i.target),o=l.closest(this.options.itemNodeName),r=o.offset();this.placeEl.css("height",o.height()),a.offsetX=i.pageX-r.left,a.offsetY=i.pageY-r.top,a.startX=a.lastX=r.left,a.startY=a.lastY=r.top,this.dragRootEl=this.element,this.dragEl=e.$(document.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",o.width()),s=this.dragEl,this.tmpDragOnSiblings=[o[0].previousSibling,o[0].nextSibling],o.after(this.placeEl),o[0].parentNode.removeChild(o[0]),o.appendTo(this.dragEl),t(document.body).append(this.dragEl),this.dragEl.css({left:r.left,top:r.top});var d,h,p=this.dragEl.find(this.options.itemNodeName);for(d=0;d<p.length;d++)h=t(p[d]).parents(this.options.listNodeName).length,h>this.dragDepth&&(this.dragDepth=h);n.addClass(this.options.movingClass)},dragStop:function(){var t=this.dragEl.children(this.options.itemNodeName).first();t[0].parentNode.removeChild(t[0]),this.placeEl.replaceWith(t),this.dragEl.remove(),(this.tmpDragOnSiblings[0]!=t[0].previousSibling||this.tmpDragOnSiblings[1]&&this.tmpDragOnSiblings[1]!=t[0].nextSibling)&&(this.element.trigger("change.uk.nestable",[t,this.hasNewRoot?"added":"moved"]),this.hasNewRoot&&this.dragRootEl.trigger(e.prefix("change.uk.nestable"),[t,"removed"])),this.reset(),n.removeClass(this.options.movingClass)},dragMove:function(e){var s,i,n,l,r,d=this.options,h=this.mouse;this.dragEl.css({left:e.pageX-h.offsetX,top:e.pageY-h.offsetY}),h.lastX=h.nowX,h.lastY=h.nowY,h.nowX=e.pageX,h.nowY=e.pageY,h.distX=h.nowX-h.lastX,h.distY=h.nowY-h.lastY,h.lastDirX=h.dirX,h.lastDirY=h.dirY,h.dirX=0===h.distX?0:h.distX>0?1:-1,h.dirY=0===h.distY?0:h.distY>0?1:-1;var p=Math.abs(h.distX)>Math.abs(h.distY)?1:0;if(!h.moving)return h.dirAx=p,h.moving=!0,void 0;h.dirAx!==p?(h.distAxX=0,h.distAxY=0):(h.distAxX+=Math.abs(h.distX),0!==h.dirX&&h.dirX!==h.lastDirX&&(h.distAxX=0),h.distAxY+=Math.abs(h.distY),0!==h.dirY&&h.dirY!==h.lastDirY&&(h.distAxY=0)),h.dirAx=p,h.dirAx&&h.distAxX>=d.threshold&&(h.distAxX=0,n=this.placeEl.prev(d.itemNodeName),h.distX>0&&n.length&&!n.hasClass(d.collapsedClass)&&(s=n.find(d.listNodeName).last(),r=this.placeEl.parents(d.listNodeName).length,r+this.dragDepth<=d.maxDepth&&(s.length?(s=n.children(d.listNodeName).last(),s.append(this.placeEl)):(s=t("<"+d.listNodeName+"/>").addClass(d.listClass),s.append(this.placeEl),n.append(s),this.setParent(n)))),h.distX<0&&(l=this.placeEl.next(d.itemNodeName),l.length||(i=this.placeEl.parent(),this.placeEl.closest(d.itemNodeName).after(this.placeEl),i.children().length||this.unsetParent(i.parent()))));var c=!1;if(o||(this.dragEl[0].style.visibility="hidden"),this.pointEl=t(document.elementFromPoint(e.pageX-document.body.scrollLeft,e.pageY-(window.pageYOffset||document.documentElement.scrollTop))),o||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(d.handleClass))this.pointEl=this.pointEl.closest(d.itemNodeName);else{var m=this.pointEl.closest("."+d.itemClass);m.length&&(this.pointEl=m.closest(d.itemNodeName))}if(this.pointEl.hasClass(d.emptyClass))c=!0;else if(this.pointEl.data("nestable")&&!this.pointEl.children().length)c=!0,this.pointEl=t(this.tplempty).appendTo(this.pointEl);else if(!this.pointEl.length||!this.pointEl.hasClass(d.listitemClass))return;var g=this.element,f=this.pointEl.closest("."+this.options.listBaseClass),u=g[0]!==this.pointEl.closest("."+this.options.listBaseClass)[0],E=f;if(!h.dirAx||u||c){if(u&&d.group!==E.data("nestable-group"))return;if(a.push(g),r=this.dragDepth-1+this.pointEl.parents(d.listNodeName).length,r>d.maxDepth)return;var v=e.pageY<this.pointEl.offset().top+this.pointEl.height()/2;i=this.placeEl.parent(),c?this.pointEl.replaceWith(this.placeEl):v?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),i.children().length||i.data("nestable")||this.unsetParent(i.parent()),this.dragRootEl.find(d.itemNodeName).length||this.dragRootEl.children().length||this.dragRootEl.append(this.tplempty),u&&(this.dragRootEl=f,this.hasNewRoot=this.element[0]!==this.dragRootEl[0])}}}),e.nestable});